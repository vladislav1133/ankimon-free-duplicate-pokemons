<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap File Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
      .duplicate td { background: rgba(255, 228, 196, 0.43); }
  </style>
</head>
<body>

<div class="container mt-5">
  <h1 class="text-center text-primary">Upload JSON Files</h1>

  <div class="mb-3">
    <label for="fileInput1" class="form-label">Choose All Pokémon File:</label>
    <input type="file" class="form-control" id="fileInput1" accept=".json">
  </div>

  <div class="mb-3">
    <label for="fileInput2" class="form-label">Choose Main Pokémon File:</label>
    <input type="file" class="form-control" id="fileInput2" accept=".json">
  </div>

  <button class="btn btn-success" onclick="readJSONs()">Upload Both</button>

  <p class="mt-3" id="output"></p>
  <p><strong>Unique Pokémon Count:</strong> <span id="uniqueCount">0</span></p>
  <p><strong>All Pokémon Count:</strong> <span id="allCount">0</span></p>

  <table class="table table-bordered mt-4 d-none" id="dataTable">
    <thead class="table-dark">
    <tr>
      <th>Image</th>
      <th>Name - ID - Level</th>
      <th>Game Individual ID</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
  let allPokemon = [];
  let mainPokemon = [];
  let nameCounts = {};

  function readJSONs() {
    let fileInput1 = document.getElementById("fileInput1");
    let fileInput2 = document.getElementById("fileInput2");

    if (!fileInput1.files.length || !fileInput2.files.length) {
      document.getElementById("output").innerText = "Please select both JSON files.";
      return;
    }

    let reader1 = new FileReader();

    reader1.onload = function(event) {
      try {
        allPokemon = JSON.parse(event.target.result);
        if (!Array.isArray(allPokemon)) {
          document.getElementById("output").innerText = "Error: First file must be a list of objects.";
          return;
        }
        console.log('---', `allPokemon`, allPokemon);

        processSecondFile();
      } catch (error) {
        document.getElementById("output").innerText = "Error: Invalid first JSON file.";
        console.error("Error parsing JSON:", error);
      }
    };
    reader1.readAsText(fileInput1.files[0]);

    function processSecondFile() {
      let reader2 = new FileReader();
      reader2.onload = function(event) {
        try {
          mainPokemon = JSON.parse(event.target.result);
          if (!Array.isArray(mainPokemon)) {
            document.getElementById("output").innerText = "Error: Second file must be a list of objects.";
            return;
          }
          console.log('---', `mainPokemon`, mainPokemon);
          countNames();
          renderTable();
        } catch (error) {
          document.getElementById("output").innerText = "Error: Invalid second JSON file.";
          console.error("Error parsing JSON:", error);
        }
      };
      reader2.readAsText(fileInput2.files[0]);
    }
  }

  function countNames() {
    nameCounts = {};
    allPokemon.forEach(obj => {
      if (obj.name) {
        nameCounts[obj.name] = (nameCounts[obj.name] || 0) + 1;
      }
    });
  }

  function renderTable() {
    let tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = "";

    allPokemon.sort((a, b) => a.id - b.id).forEach(obj => {
      if (obj.id && obj.name && obj.individual_id) {
        let imgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${obj.id}.png`;

        let row = `<tr class="${nameCounts[obj.name] > 1 ? 'duplicate' : ''}">
          <td><img src="${imgUrl}" alt="${obj.name}" width="80" height="80"></td>
          <td>${obj.name} - ID: ${obj.id} - lvl: ${obj.level}</td>
          <td>${obj.individual_id}</td>
          <td>${nameCounts[obj.name] > 1 ? `<button class="btn btn-sm btn-danger" onclick="removeEntry('${obj.individual_id}')">Remove</button>` : ''}</td>
        </tr>`;

        tableBody.innerHTML += row;
      }
    });

    document.getElementById("dataTable").classList.remove("d-none");
    document.getElementById("output").innerText = "JSON Processed Successfully!";
    updateCounts();
  }

  function removeEntry(individual_id) {
    allPokemon = allPokemon.filter(obj => obj.individual_id !== individual_id);

    countNames();
    renderTable();
    updateCounts();
  }

  function updateCounts() {
    document.getElementById("allCount").innerText = allPokemon.length;
    let uniqueNames = new Set(allPokemon.map(obj => obj.name));
    document.getElementById("uniqueCount").innerText = uniqueNames.size;
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
