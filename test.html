<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Collection</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body data-bs-theme="dark" class="p-3">

<div class="container">
  <h2 class="mb-3">Pokémon Collection</h2>

  <!-- File Input -->
  <input type="file" id="fileInput" class="form-control mb-3">

  <!-- Accordion Container -->
  <div class="accordion" id="pokemonAccordion"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.getElementById("fileInput").addEventListener("change", handleFileUpload);

  function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const pokemons = JSON.parse(e.target.result);
        displayPokemon(pokemons);
      } catch (error) {
        console.error("Invalid JSON file:", error);
      }
    };
    reader.readAsText(file);
  }

  function displayPokemon(pokemons) {
    const groupedByDate = {};

    // Group Pokémon by "captured_date"
    pokemons.forEach(pokemon => {
      const date = pokemon.captured_date.split(" ")[0]; // Extract only the date
      if (!groupedByDate[date]) groupedByDate[date] = [];
      groupedByDate[date].push(pokemon);
    });

    // Sort dates (newest first)
    const sortedDates = Object.keys(groupedByDate).sort((a, b) => new Date(b) - new Date(a));

    const accordion = document.getElementById("pokemonAccordion");
    accordion.innerHTML = ""; // Clear previous content

    let index = 0;
    sortedDates.forEach(date => {
      const pokemons = groupedByDate[date];

      // Create accordion item
      const accordionItem = document.createElement("div");
      accordionItem.classList.add("accordion-item");

      accordionItem.innerHTML = `
          <h2 class="accordion-header">
            <button class="accordion-button ${index !== 0 ? "collapsed" : ""}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}">
              ${date} ( ${pokemons.length} Pokémon )
            </button>
          </h2>
          <div id="collapse${index}" class="accordion-collapse collapse ${index === 0 ? "show" : ""}" data-bs-parent="#pokemonAccordion">
            <div class="accordion-body">
              <table class="table table-dark table-striped">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Level</th>
                    <th>Type</th>
                    <th>Ability</th>
                  </tr>
                </thead>
                <tbody>
                  ${pokemons.map(pokemon => `
                    <tr>
                      <td><img src="${getPokemonImage(pokemon.id)}" alt="${pokemon.name}" width="100"></td>
                      <td>${pokemon.name}</td>
                      <td>${pokemon.level}</td>
                      <td>${pokemon.type.join(", ")}</td>
                      <td>${pokemon.ability}</td>
                    </tr>
                  `).join("")}
                </tbody>
              </table>
            </div>
          </div>
        `;
      accordion.appendChild(accordionItem);
      index++;
    });
  }

  function getPokemonImage(id) {
    return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
  }
</script>

</body>
</html>
